#!/usr/bin/env bash

infile1=test.sam.fmt
infile2=test.fa
cmd=samtools
if [[ -e "${infile1}" && $(type -P "${cmd}") ]]; then
    samtools sort -o test.sam.fmt.srt ${infile1};
    rm ${infile1};
elif [[ ! $(type -P "${cmd}") ]]; then
    rm -f ${infile1};
    echo "${cmd} not found; skipping remaining tests";
    exit 77;
else
    echo "${infile1} not found; skipping remaining tests";
    exit 77;
fi

if [[ -e "${infile2}" && -e test.sam.fmt.srt ]]; then
    ./dnmtools bsrate -c ${infile2} test.sam.fmt.srt | awk 'NR==1{print $5}';
    rm test.sam.fmt.srt;
else
    exit 1;
fi
